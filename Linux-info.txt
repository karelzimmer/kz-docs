###############################################################################
# SPDX-FileComment: Text file containing Linux information
#
# SPDX-FileCopyrightText: Karel Zimmer <info@karelzimmer.nl>
# SPDX-License-Identifier: CC0-1.0
###############################################################################

Maak een opstartbare USB-stick / Create a bootable USB stick
============================================================

In een grafische werkomgeving
-----------------------------
Plaats een usb-stick van minimaal 8 GB.
Zoek sch en klik op het pictogram van Schijven.
Selecteer de USB-stick in de lijst van schijven aan de linkerkant en klik
rechtsboven op Schijfinstellingen ⋮ (icoontje met de drie puntjes).
Kies Schijfkopie terugzetten en selecteer het gedownloade cd-beeldbestand (.iso).
Klik op Terugzetten starten en vervolgens op Terugzetten.
Of gebruik het programma Etcher (etcher.io) dat beschikbaar is voor Windows, macOS, en Linux.

In een Terminalvenster
----------------------
Plaats een usb-stick van minimaal 8 GB.
$ findmnt
Zoek de regel die begint met /media/<user>/<usblabel> (kolom TARGET) en noteer
de apparaatnaam /dev/sd<XN> (kolom SOURCE).
Voer uit:
umount /dev/sd<XN>
sudo dd bs=4M conv=fsync status=progress if=~/Downloads/<isonaam> of=/dev/sd<X>

Of gebruik Ventoy
-----------------
Plaats de Ventoy usb-stick [1].
Kopieer één of meer gedownloade cd-beeldbestanden (.iso) naar Ventoy.
Start de computer op vanaf de Ventoy usb-stick.
Over Secure Boot in UEFI-modus, zie https://www.ventoy.net/en/doc_secure.html.

[1] Om een Ventoy USB-stick aan te maken,
    zie https://www.ventoy.net> Document > Get Started.

/

In a graphical work environment
-------------------------------
Insert a USB stick of at least 8 GB.
Locate disk and click the Disks icon.
Select the USB stick in the list of disks on the left and click
Disk settings ⋮ (icon with the three dots) in the top right corner.
Choose Restore Disk Image and select the downloaded CD image file (.iso).
Click Start Restore, and then click Restore.
Or use the Etcher program (etcher.io) available for Windows, macOS, and Linux.

In a Terminal
-------------
Insert a USB stick of at least 8 GB.
$ findmnt
Find the line that starts with /media/<user>/<usblabel> (TARGET column) and note
the device name /dev/sd<XN> (SOURCE column).
Execute:
umount /dev/sd<XN>
sudo dd bs=4M conv=fsync status=progress if=~/Downloads/<isonaam> of=/dev/sd<X>

Or use Ventoy
-------------
Insert the Ventoy USB stick [1].
Copy one or more downloaded CD image files (.iso) to Ventoy.
Boot from the Ventoy USB stick.
About Secure Boot in UEFI mode, see https://www.ventoy.net/en/doc_secure.html.

[1] To create a Ventoy USB stick,
    see https://www.ventoy.net> Document > Get Started.


Als het installeren/bijwerken mislukt / If installing/updating fails
====================================================================

Als om één of andere reden het installeren/bijwerken mislukt, op een
Debian-gebaseerd systeem kunt u het volgende proberen:
   sudo dpkg --configure --pending
   sudo apt-get update --fix-missing
   sudo apt-get install --fix-broken
Op een Red Hat-gebaseerd systeem probeer het volgende:
   sudo dnf clean all
   sudo dnf makecache
/

If the install/update fails for some reason, on a Debian-based system you can
try the following:
   sudo dpkg --configure --pending
   sudo apt-get update --fix-missing
   sudo apt-get install --fix-broken
On a Red Hat-based system try the following:
   sudo dnf clean all
   sudo dnf makecache


UNIX, Linux, and distro's
=========================
Linux is gestandaardiseerd op drie manieren:
1. POSIX
    Zelfs POSIX+
2. Freedsktop
    desktop entry spec, systemd, basedir, ...
3. LSB (Linux Standard Base)
    modules, naamgeving, compiler-opties, FHS (Filesystem Hierarchy Standard)

Unix:
Boek UNIX het *standaard* operating system, H.J. Thomassen, Academic Services.
Linux:
Boek LINUX: Rute User's Tutorial and Exposition, Paul Sheer, Prentice Hall PTR
Distro:
Boek The Official Ubuntu Book - Ninth Edition, Matthew Helmke et.al, Prentice Hall
Boek The Official Ubuntu Server Book - Third Edition, Kyle Rankin and Benjamin Mako Hill, Prentice Hall
Boek The Debian (The *Universal* Operating System) Administrator's Handbook, Raphaël Hertzog and Roland Mas, Freexian


Verifying shim SBAT data / SBAT self-check failed: Security Policy Violation
============================================================================
Disable Secure Boot, boot into Ubuntu and run:

mokutil --list-sbat-revocations
 sbat,1,2024010900
 shim,2
 grub,3
Something like this will show, so sbat it's blocking shim and grub.

Delete the SBAT policy with:
mokutil --set-sbat-policy delete

Reboot whithout Secure Boot again and check:
mokutil --list-sbat-revocations
 sbat,1,2021030218

Now nothing it's blocked, reboot, enable Secure Boot and all should be fine.


Install zstd package on Debian < 12
===================================
# On Debian, dpkg version 1.21.18 has zstd support for .deb archives,
# on Ubuntu the default is zstd from Ubuntu 21.10.
# Debian 11 has dpkg version < 1.21.18 that does not support zstd.
# Debian 12 has dpkg version > 1.21.18 that does supports zstd.
# If on Debian < 12 and need to install a .deb package that uses zstd,
# you can repack it:
# Install required packages
sudo apt install binutils zstd
# Extract files from the archive
ar x <debfile>
# Uncompress zstd files an re-compress them using xz
zstd -d < control.tar.zst | xz > control.tar.xz
zstd -d < data.tar.zst | xz > data.tar.xz
# Re-create the Debian package
ar -m -c -a sdsd <debfile_xz> debian-binary control.tar.xz data.tar.xz
# Clean up
rm debian-binary control.tar.xz data.tar.xz control.tar.zst data.tar.zst
# Install <debfile_xz>
sudo apt install <debfile_xz>


Voorkom een overstroming van 'AER: Corrected error received' in het logboek
===========================================================================
Wijzig de opstartparameters wanneer het GRUB-bootloadermenu verschijnt.
Selecteer de optie "Ubuntu installeren", druk op 'e' om de opdrachten te
bewerken voordat u opstart.
Voeg “pci=noaer” (of “pci=nomsi”, of "pci=noaer,nomsi”) toe aan het einde van
de regel beginnend met 'linux'.
Druk vervolgens op Ctrl-X of druk op F10 om op te starten.

En druk later op de linker- of rechter Shift-toets om de parameter(s) aan de
regel toe te voegen.

Maak het permanent door "/etc/default/grub" bij te werken en de parameters
toe te voegen aan "GRUB_CMDLINE_LINUX_DEFAULT" met dubbele aanhalingstekens na
de woorden "quiet splash".
Voer vervolgens uit: sudo update-grub
Start het systeem opnieuw op.


GNOME
=====
Press Super and use the Mouse Scroll Wheel to switch workspaces.
Press Super and Right-click anywhere on a window to open the window menu, you
   can then take screenshots, hide the window, change window behavior and more.
Press Super and drag anywhere on any window to move it. (No need to grab the
   top bar to move)


Colored less
============
grep --color=always REGEXP SOURCE | less --raw-control-chars
git diff --color=always | less -r


Git/GitHub
==========
Aangepaste prompt
-----------------
source /etc/bash_completion.d/git-prompt
export GIT_PS1_SHOWDIRTYSTATE=1
export PS1='\[\e]0;\u@\h: \w\a\]${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]$(__git_ps1 "(%s)")\$ '

Git alias
---------
git config --global alias.logg 'log --decorate --graph --oneline --all'

Lokale git repo voor teksten of scripts
---------------------------------------
sudo apt-get instal git
git config --global user.name 'Karel Zimmer'
git config --global user.email 'karel.zimmer@gmail.com'
git config --global core.editor "code --wait"      # To make rebase -i possible
git config --global pull.ff only
git config --global credential.helper store

git config --global push.autoSetupRemote true
git push
-or-
git push --set-upstream origin feature/redesign-checklists

git config --list
mkdir article
cd article
git init

Aanmaken/wijzigen/verwijderen documenten
----------------------------------------
git add .
git status
git commit -m "Initial version of article"
git commit --amend -m "First version of article"

Remote git repo voor documenten of scripts, e.g. GitHub
-------------------------------------------------------
Maak repo op website.
DOWNLOAD
git clone https://github.com/karelzimmer/kz-docs.git ~
git clone https://github.com/karelzimmer/kz-scripts.git ~
git config --global user.name 'Karel Zimmer'
git config --global user.email 'karel.zimmer@gmail.com'

UPLOAD
git config --global credential.helper store
Hierna geen username/password meer nodig.

ROLL BACK
git config --global --unset credential.helper
git push
Username for 'https://github.com': <username>
Password for 'https://<username>@github.com': <password>

Git config levels and files
---------------------------
--local   lokaal  configuratiebestand in repo's .git directory: .git/config
--global  globaal configuratiebestand in ~ /.gitconfig
--system  systeem configuratiebestand in $(prefix)/etc/gitconfig

Branch names and prefixes
-------------------------
Main repository branch:
   main                          of master

Branch prefixes:
   bugfix/		                  fix bug in code, e.g. bugfix/fix-login-error
   customers/	                  specific branch for a customer
   develop/	                     development
   docs/		                     write, update, and fix documentation
   feature/	                     new features, e.g. feature/<projectname>
   hotfix/		                  fix critical bug, e.g. hotfix/<incidentnumber>
   release/	                     new production version
   users/<username>/<desc>/      personal branche
   users/<username>/<workitem>/  personal branche

Git Branching & Merging
-----------------------
main                    standard branch na 'git init'
-of-
master                  < oktober 2020, gewijzigd naar main ivm culturele
                          aspecten zoals master/slave

<branchname>            branch is in feite een verwijzing naar een momentopname van je wijzigingen
HEAD                    verwijst naar de huidige commit die je aan het bekijken bent ("pointer")

git branch              # list active (*) and other branches
git branch <branchname> # maak <branchname>
git switch <branchname> # switch naar <branchname>

git status              # wijzigingen zijn zichtbaar in main & <branchname>
git add .               # wijzigingen zijn zichtbaar in main & <branchname>
git commit -m <message> # wijzigingen zijn zichtbaar alleen in <branchname>
git push                # 1e keer: git push --set-upstream origin <branchname>

git switch main         # schakel over naar main (HEAD <branchname> -> main)
git merge <branchname>  # maak main gelijk aan de <branchname>
git status
git push

Squash commit
-------------
git switch main
git merge --squash <branchname>
git diff --staged
git commit -m [<message>]
git push [origin main]
git branch --delete <branchname>
git push origin --delete <branchname>
git fetch --prune          # remove any no longer existing remote references

Rewriting commits
-----------------
git config --global core.editor "code --wait"
git rebase -i <commit>
[follow instructions in file git-rebase-todo]
[follow instructions in file COMMIT_EDITMSG]
git push -f

Branch main is ahead of branch develop
--------------------------------------
git diff main..develop
git switch develop
git rebase main
git push
git diff main..develop
git diff main..develop --compact-summary # only filenames

Rename branch
-------------
git branch --move <oldbranch> <newbranch>
git push origin --delete <oldbranch>
git push --set-upstream origin <newbranch>

Informatie
----------
git reflog

git config --list                   # raadplegen
git remote set-url origin <new-url> # wijzigen

git log
git log -10
git log --oneline

git show SHA1

git diff working <-> staged
git diff 'SHA1-A' 'SHA1-B' log --oneline

# fatal: CRLF would be replaced by LF in file.txt
git config --global core.autocrlf false

Rename branch master to main
----------------------------
git branch -m master main
git fetch origin
git branch -u origin/main main
git remote set-head origin -a

Git-ignore
----------
vi .gitignore   In root van de repo.
Verwijder FILE uit repo, maar houd hem in werkmap als ignored file.
git rm --cached FILE
git rm -r --cached DIR

Persé lege dirs in repo? Doe in lege map voor de push
-----------------------------------------------------
touch .gitignore

Meldingen over git pull en fast-forward?
----------------------------------------
git pull
git config pull.ff only
git config --global pull.ff only
git clean -d  -f .


Proces slapen met Ctrl-Z
========================
Overzicht met jobs,
kill met kill %<nummer>,
resume in background via bg %<nummer >,
resume in foreground via fg %<nummer >.


Mount NAS
=========
Example
-------
Mount NAS_IP_ADDRESS/data on /mnt/data.

Make sure the NAS has a fixed IP address NAS_IP_ADDRESS.
This requires:

  - the MAC address of the NAS (looks like aa:bb:cc:dd:ee:ff)
  - access the NAS via a web browser
  - access the router via a web browser

  1. Select the MAC address of the NAS in the router
     IP address outside the range of DHCP automatically
     distributes the IP addresses (often 192.168.0.200).
  2. Select the fixed IP address in the NAS and turn off DHCP.

sudo apt-get install --yes cifs-utils samba

Create login file
-----------------
sudo vi /etc/data.login
username=<nas_username>
password=<nas_password>

:x
chmod --verbose '600' /etc/data.login

Create systemd mount service file
---------------------------------
sudo vi /etc/systemd/system/mnt-data.mount
[Unit]
Description=Mount NAS Directory

[Mount]
What=//NAS_IP_ADDRESS/data
Where=/mnt/data
Type=cifs
Options=credentials=/etc/data.login,vers=1.0,rw,noperm,iocharset=utf8,dir_mode=0777,file_mode=0777

[Install]
WantedBy=multi-user.target
:x

Activate systemd mount service file
-----------------------------------
systemctl enable mnt-data.mount
systemctl start mnt-data.mount
systemctl daemon-reload
systemctl status mnt-data.mount

Deactivate the systemd mount file and remove the NAS login
----------------------------------------------------------
sudo systemctl disable mnt-data.mount
sudo rm /etc/data.login


Localization: t9n, l10n, i18n, g11n
===================================
t9n = translation
l10n = localization
i18n = internationalization
g11n = globalization

Gettext .pot/.po/.mo files
--------------------------
# WERKWIJZE
# ---------
cd ~/scripts

### 1-MALIG ###

sudo apt install gettext
mkdir --parents nl/LC_MESSAGES

Voeg 1 of meer gettext's toe in script Bash script
--------------------------------------------------
!/bin/bash

export TEXTDOMAIN=helloworld
export TEXTDOMAINDIR=/home/karel/scripts
source /usr/bin/gettext.sh

program_name=helloworld.sh

printf '%s\n' "$(eval_gettext "Program name: \$program_name")"

printf '%s\n' "$(gettext 'Hello world!')"

Voeg 1 of meer gettext's toe in Python script
---------------------------------------------
!/bin/python

import gettext

gettext.bindtextdomain('helloworld', '/home/karel/scripts')
gettext.textdomain('helloworld')
_ = gettext.gettext

program_name = 'helloworld.py'

print(_('Program name: {}').format(program_name))

print(_('Hello world!'))

Maak .pot
---------
xgettext --language=Shell --no-location --output=helloworld.pot helloworld.sh
xgettext --language=Python --no-location --output=helloworld.pot helloworld.py

Maak .po
--------
msginit --locale=nl --input=helloworld.pot --output-file=nl/LC_MESSAGES/helloworld.po

Wijzig 1-malig .po
------------------
# Content-Type: text/plain; charset=UTF-8\n" <== UTF-8
# PACKAGE -> helloworld
# VERSION -> 0.1

Maak .mo
--------
msgfmt --output-file=nl/LC_MESSAGES/helloworld.mo nl/LC_MESSAGES/helloworld.po

### Test de vertaling ###

Voeg [eval_]gettext's toe in script en update .pot
--------------------------------------------------
xgettext --language=Shell --join-existing --no-location --output=helloworld.pot helloworld.sh
xgettext --language=Python --join-existing --no-location --output=helloworld.pot helloworld.py

Update .po
----------
msgmerge --update --backup=none --previous --no-location nl/LC_MESSAGES/helloworld.po helloworld.pot

Wijzig als vertaler .po
-----------------------
# msgid "Hello world!"
# msgstr "" --> "Hallo wereld!"
Etc.

Update .mo na iedere vertaling
------------------------------
msgfmt --output-file=nl/LC_MESSAGES/helloworld.mo nl/LC_MESSAGES/helloworld.po

### Test de vertaling ###

Zie ook ~/bin/pogen en ~/bin/mogen, en ~/kz-scripts/usr/bin/.

Voer pogen uit voor alle scripts:
cd ~/kz-scripts/usr/bin
for file in $(find . -executable -type f -print); do pogen $file;done


LUKS - Ondersteuning voor schijfversleuteling
=============================================
Om de harddisk te versleutelen, vink aan tijdens het installeren
----------------------------------------------------------------
De nieuwe installatie van Ubuntu versleutelen voor de veiligheid, en ook LVM gebruiken bij de nieuwe installatie van Ubuntu wordt dan aangevinkt, of vink aan Encrypteer systeem (Debian).
-of-
Na het installeren met ecryptfs-utils en cryptsetup, zie o.a
------------------------------------------------------------
https://www.howtogeek.com/116032/how-to-encrypt-your-home-folder-after-installing-ubuntu/
en
https://jumpcloud.com/blog/how-to-encrypt-ubuntu-20-04-desktop-post-installation

Daarna
------
1. Gebruiker automatisch aanmelden.
2. Wachtwoord verwijderen sleutelbossen.
3. LUKS-wachtwoord toevoegen.

1. Gebruiker automatisch aanmelden.
Druk op de Super-toets, typ gebr en klik achter Instellingen op Gebruikers.
Klik op Ontgrendelen en zet daarna Automatisch aanmelden met het schuifje aan.

2. De aanmeldsleutelbos werd niet automatisch ontgrendeld bij uw aanmelding.
   1. Start Wachtwoorden en sleutels.
   2. Onder Wachtwoorden voer uit voor iedere sleutelbos:
      1. Rechtsklik op Sleutelbos.
      2. Kies Wachtwoord wijzigen.
      3. Geef het oude wachtwoord op en klik op Doorgaan.
      4. Geef als nieuw wachtwoord tweemaal niets op en klik op Doorgaan.
  3. Sluit Wachtwoorden en sleutels af.

3. LUKS-wachtwoord toevoegen.

Bepaal welke partitie LUKS bevat
--------------------------------
Voorbeeld 1:
lsblk
NAME                  MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINTS
...
sda                     8:0    0 232,9G  0 disk
├─sda1                  8:1    0   512M  0 part  /boot/efi
├─sda2                  8:2    0   732M  0 part  /boot
└─sda3                  8:3    0 231,7G  0 part
  └─sda3_crypt        253:0    0 231,7G  0 crypt
...
In bovenstaand geval dus /dev/sda3.

Voorbeeld 2:
lsblk
NAME                                          MAJ:MIN RM   SIZE RO TYPE
...
sdb                                             8:16   0 232,9G  0 disk
└─sdb1                                          8:17   0 231,9G  0 part
  └─luks-a805d665-da6b-4872-8370-1ae4eb0bfc53 253:3    0 231,9G  0 crypt
...
In bovenstaand geval dus /dev/sdb1.

Om een LUKS-wachtwoord toe te voegen, start Terminalvenster en voer uit:
sudo cryptsetup luksAddKey /dev/NAME

Om een LUKS-wachtwoord aan te passen, start Terminalvenster en voer uit:
sudo cryptsetup luksChangeKey /dev/NAME

Voor het aantal LUKS-wachtwoorden, start Terminalvenster en voer uit:
sudo cryptsetup luksDump /dev/NAME

Om een LUKS-wachtwoord te verwijderen, start Terminalvenster en voer uit:
sudo cryptsetup luksRemoveKey /dev/NAME

Mocht je het wachtwoord van slot 0 vergeten zijn, en je weet nog het wachtwoord van slot 1, voer dan uit:
sudo cryptsetup luksKillSlot /dev/NAME 0
-of-
Gebruik Schijven > klik op juiste schijf > klik op LUKS-partitie > klik op tandwiel-symbool > Wachtwoord wijzigen.


Dual-boot met Windows
=====================
VOORBEREIDEN
Uitzetten Snel opstarten (Fast Startup):
1. Druk op de Windows-toets, typ 'energie' en klik op Energiebeheer (Power Options).
2. In het linkerpaneel, klik op Het gedrag van de aan/uit knoppen bepalen (Choose what the power buttons do).
3. Klik op Instellingen wijzigen die momenteel niet beschikbaar zijn (Change settings that are currently unavailable).
4. Vink uit: Snel opstarten inschakelen (aanbevolen) (Turn on fast startup (recommended)).
5. Klik op Wijzigingen opslaan (Save changes).
6. Sluit scherm Energiebeheer (Power Options).

Uitzetten Apparaatversleuteling (BitLocker):
1. Druk op de Windows-toets, typ 'bitlocker' en klik op Instellingen voor apparaatversleuteling (BitLocker Drive Encryption).
2. Achter Apparaatversleuteling (BitLocker Drive Encryption) zet schuifje op Uit (Off).
3. Op het scherm Apparaatversleuteling uitschakelen (BitLocker Drive Encryption) klik op Uitschakelen (Turn off BitLocker).
4. Sluit scherm Instellingen voor apparaatversleuteling (BitLocker Drive Encryption).

INSTALLEREN
Ubuntu of Debian GNU/Linux.

HERSTELLEN
Bootloader herstellen met Super Grub2 Disk
------------------------------------------
MAKEN
Download image.
https://www.supergrubdisk.org/category/download/supergrub2diskdownload/super-grub2-disk-stable/
wget --output-document=/tmp/super_grub2_disk.iso https://netcologne.dl.sourceforge.net/project/supergrub2/2.04s1/super_grub2_disk_2.04s1/super_grub2_disk_hybrid_2.04s1.iso

Controleer iso.
sha256sum /tmp/super_grub2_disk.iso

Plaats USB-stick, hier /dev/sdb, controleer met lsblk!
Start Schijven/Gnome Disks.
Selecteer de USB-stick in de lijst van schijven aan de linkerkant en
klik rechtsboven op Schijfinstellingen ⋮ (icoontje met de drie puntjes).
Kies Schijfkopie terugzetten/Restore Disk Image en selecteer /tmp/super_grub2_disk.iso.
Klik op Terugzetten starten/Start Restoring en vervolgens op Terugzetten/Restore.

GEBRUIKEN
Herstart de computer vanaf de USB-stick en kies de optie 'Detect en show boot methods'.
Selecteer het gewenste besturingssysteem om te booten en druk op <Enter>.
Herinstalleer de bootloader na
lsblk
als mountpoint / bij sda staat, met
sudo grub-install /dev/sda
Controleer of de computer nu correct boot, en Windows en Linux weer bruikbaar
zijn, zonder de Super Grub2 Disk.

Als Windows niet zichtbaar is in het GRUB boot menu is de work-around:
Voeg GRUB_DISABLE_OS_PROBER=false toe aan /etc/default/grub en voer uit
sudo update-grub

Restore grub2 in Legacy or EFI mode
-----------------------------------
1. Boot from Super Grub2 Disk Live-USB stick.
2. Open the Terminal.
3. Execute: [ -d /sys/firmware/efi ] && echo "EFI boot on HDD" || echo "Legacy boot on HDD" ]
4. A. For Bios legacy mode.
      $ sudo su
      $ apt-get install --reinstall grub
      $ grub-install /dev/sda
      $ update-grub
4. B. For EFI - x86_64-efi.
      $ sudo su
      $ apt-get install --reinstall grub-efi-amd64
      $ grub-install /dev/sda
      $ update-grub


Pop!_OS dual-boot
=================
Start from Live distro
sudo apt install os-prober
sudo os-prober
sudo update-grub


Boot/recovery menu
==================
BIOS: Shift-toets ingedrukt houden
UEFI: Esc-toets meerdere malen indrukken


Zwart scherm bij opstarten
==========================
Probeer een 'nomodeset' op te geven als opstartparameter.
Ref: https://askubuntu.com/questions/162075/


Boot-repair (ook vanaf live-cd)
===============================
sudo add-apt-repository ppa:yannubuntu/boot-repair
sudo apt-get update
sudo apt install boot-repair        Voor repareren GRUB: Boot-reparatie
sudo boot-repair
sudo apt install startupmanager     Evt. voor aanpassen GRUB: Opstart-Manager
sudo startupmanager


GRUB-menu zichtbaar maken
=========================
sudo -i
gedit /etc/default/grub
Wijzig: #GRUB_HIDDEN_TIMEOUT=0
        #GRUB_HIDDEN_TIMEOUT_QUIET=true
sudo update-grub
exit


GRUB-menu ander menuitem starten
================================
sudo -i
gedit /etc/default/grub
Wijzig: GRUB_DEFAULT=0 -> GRUB_DEFAULT=1 (of 2, 3, etc.)
sudo update-grub
exit


Zorg dat de helderheid van laptopscherm correct is bij het opstarten
====================================================================
1. Zet helderheid op de gewenste waarde.
2. Vraag helderheid op met:
ls /sys/class/backlight/*/brightness
   zeg: /sys/class/backlight/intel_backlight/brightness
cat /sys/class/backlight/intel_backlight/brightness
   zeg: 1900
3. Leg gewenste helderheid vast:
sudo vi /etc/rc.local
   Voeg regels toe:
#!/bin/sh
echo 1900 > /sys/class/backlight/intel_backlight/brightness
4. Zorg dat /etc/rc.local uitvoerbaar is:
sudo chmod +x /etc/rc.local


Bureaublad wordt niet goed getoond (geen juiste venster, geen starter)
======================================================================
Zie eerst: https://askubuntu.com/questions/162075/
1. Niet-afgemaakte updates
2. Beschadigd bestandssysteem
3. Meer drastische methodes
4. Als dat het niet oplost
5. En nog verder gaan

1. Niet-afgemaakte updates
--------------------------
Op het GNU GRUB opstartscherm kies Geavanceerde opties voor Ubuntu.
(Als dat menu niet verschijnt bij het opstarten, hou dan de Shift-toets ingedrukt bij het opstarten.)
Kies dan Ubuntu, with Linux... (recovery mode).
Zorg dat het netwerk bedraad beschikbaar is en kies op het Herstelmenu eerst network en daarna root.
In het Terminalvester voer uit:
sudo apt-get update
sudo apt-get upgrade
exit
Volg de eventuele aanwijzingen op het scherm (zoals sudo apt install -f).
Start de computer daarna weer op,

2. Beschadigd bestandssysteem
-----------------------------
Op het GNU GRUB opstartscherm kies Geavanceerde opties voor Ubuntu.
Kies dan Ubuntu, with Linux... (recovery mode).
Kies op het Herstelmenu voor fsck.
Volg de aanwijzingen op het scherm.

3. Meer drastische methodes
---------------------------
Op het Aanmeldscherm/Bureaublad probeer een Terminalvenster te openen met Ctrl+Alt+T of Ctrl+Alt+F1.
Voer in het Terminalvenster uit:
sudo rm -fr "$HOME"/.cache/compizconfig-1
sudo rm -fr "$HOME"/.compiz
sudo rm -fr "$HOME"/.Xauthority
sudo rm -fr "$HOME"/.config/autostart

4. En nog verder gaan (verwijdert alle, mogelijk foutieve, configuratiedata)
----------------------------------------------------------------------------
rm -rf "$HOME"/.config


Netwerkverbinding vóór het aanmelden?
=====================================
Rechtsklik bovenin op netwerk-icoon, kies Verbindingen bewerken, klik op gewenste verbinding en vervolgens op Bewerken.
Klik op Algemeen (tab) en vink aan Alle gebruikers kunnen verbinding maken met dit netwerk. Klik op Opslaan.
-of-
Ga naar /etc/NetworkManager/system-connections.
Edit gewenste verbinding en haal alles weg achter permissions=
Klaar.


MAC address spoofing
====================
ip link show INTERFACE  INTERFACE zie iwlist scan
   bijvoorbeeld: ...link/ether 00:1d:98:5a:d1:3a <== MAC address
ip link set dev INTERFACE down
ip link set dev INTERFACE address XX:XX:XX:XX:XX:XX
ip link set dev INTERFACE up


Terminal (terminalvenster) instellen (altijd maximale grootte)
==============================================================
1. Start Terminalvenster.
2. Maximaliseer het Terminalvenster.
3. Voer de volgende opdracht uit:
   echo "Terminalgrootte: $COLUMNS kolommen $LINES rijen"
4. Ga rechtsboven naar Menu ☰ (icoontje met drie streepjes) > Voorkeuren.
5. Onder Profielen klik op Naamloos.
6. Vul in achter Oorspronkelijke afmeting van de terminal: COLUMNS kolommen en LINES rijen, en sluit Voorkeuren.


Ubuntu Pro
==========
https://discourse.ubuntu.com/c/ubuntu-pro/
https://ubuntu.com/pro

KOPPELEN
pro --version
pro security-status
sudo pro attach [YOUR_TOKEN]
sudo pro enable esm-apps --beta
sudo apt-get update
sudo apt upgrade
sudo pro enable usg
pro status

canonical-livepatch status

ONTKOPPELEN
sudo pro detach


Opdracht OPDRACHT debuggen
==========================
[sudo] strace -f OPDRACHT [> trace.txt]
[sudo] strace --follow-forks OPDRACHT [> trace.txt]

sudo strace -f -p OPDRACHT-PID [> trace.txt]
sudo strace --follow-forks --attach OPDRACHT-PID [> trace.txt]


Shell script SCRIPT debuggen
============================
bash -vx ./SCRIPT
                    v = verbose (elke invoerregel tonen)
                    x = xtrace  (elke opdracht tonen)
                    n = noexec  (opdrachten lezen maar niet uitvoeren)
Enable code-stepping:
trap '(read -p "[$BASH_SOURCE:$LINENO] $BASH_COMMAND?")' DEBUG
readelf             Toon info over Executable and Linking Format uitvoerbare programma's


diff
====
diff --context ORIG.BEST. GEWIJZ.BEST. PATCHBEST.
patch
patch ORIG.BEST. PATCHBEST.


Grappige Linux-opdrachten
=========================
Zie site https://itsfoss.com/funny-linux-commands/


Paaseieren
==========
apt-get moo
aptitude moo
aptitude -v moo
aptitude -vv moo
aptitude -vvv moo   Etc.


Rechten
=======
Octaal (achttallig stelsel, 0 t/m 7):
+--2²=4
|+-2¹=2
||+2⁰=1
|||
VVV
421
rwx
000 --- 0
001 --x 1 <==
010 -w- 2 <==
011 -wx 3
100 r-- 4 <==
101 r-x 5
110 rw- 6
111 rwx 7
rwx
DUUUGGGOOO = Directory (map, - is gewoon bestamd), User (gebruiker),
    Group (groep), en Other (rest).
Bestandsrechten, de betekenis van de r, w, en x attributen:
    r - Bestand lezen.
    w - Bestand wijzigen.
    x - Bestand uitvoeren.
Maprechten, de betekenis van de r, w, en x attributen:
    r - Inhoud van map opvragen (ls MAPNAAM) als ook het x-attribuut is aangezet.
    w - Bestanden aanmaken, verwijderen, of hernoemen als ook het x-attribuut is aangezet.
    x - Toegang tot de map (cd MAPNAAM), "zoeken".
Basisrechten (base permissions):
dirs    777 (rwxrwxrwx)
files   666 (rw-rw-rw-)
Umask (user mask):
normal 0002 (dan zijn u=rwx, g=rwx, en o=rx de maximaal toegestane standaardwaarden)
root   0022 (dan zijn u=rwx, g=rx,  en o=rx de maximaal toegestane standaardwaarden)
Standaard wordt een bestand of map aangemaakt met de rechten van Basisrechten -/- Umask.
Resultaat als een normale user een map of bestand aanmaakt:
mkdir   775 (rwxrwxr-x) (777 -/- 002)
touch   664 (rw-rw-r--) (666 -/- 002)
Resultaat als de beheerder (superuser of root) een map of bestand aanmaakt:
mkdir   755 (rwxr-xr-x) (777 -/- 022)
touch   644 (rw-r--r--) (666 -/- 022)


Draai 90 graden iPhone film
===========================
mencoder -vf rotate -o Input.MOV -oac lavc -ovc lavc Output.MOV


Herstel verwijderde "Locaties" Afbeeldingen, Documenten, Downloads, etc.
========================================================================
Maak Afbeeldingen, Documenten, Downloads, etc. map aan in Persoonlijke map
gedit "$HOME"/.config/user-dirs.dirs
Wijzig XDG_PICTURES_DIR="$HOME/"  naar XDG_PICTURES_DIR="$HOME/Afbeeldingen"
Wijzig XDG_DOCUMENTS_DIR="$HOME/" naar XDG_DOCUMENTS_DIR="$HOME/Documenten"
Wijzig XDG_DOWNLOAD_DIR="$HOME/"  naar XDG_DOWNLOAD_DIR="$HOME/Downloads"
etc.
Voorbeeld "$HOME"/.config/user-dirs.dirs:
# This file is written by xdg-user-dirs-update
# If you want to change or add directories, just edit the line you're
# interested in. All local changes will be retained on the next run.
# Format is XDG_xxx_DIR="$HOME/yyy", where yyy is a shell-escaped
# homedir-relative path, or XDG_xxx_DIR="/yyy", where /yyy is an
# absolute path. No other format is supported.
#
XDG_DESKTOP_DIR="$HOME/Bureaublad"
XDG_DOWNLOAD_DIR="$HOME/Downloads"
XDG_TEMPLATES_DIR="$HOME/Sjablonen"
XDG_PUBLICSHARE_DIR="$HOME/Openbaar"
XDG_DOCUMENTS_DIR="$HOME/Documenten"
XDG_MUSIC_DIR="$HOME/Muziek"
XDG_PICTURES_DIR="$HOME/Afbeeldingen"
XDG_VIDEOS_DIR="$HOME/Video's"

Weer af- en aanmelden!
Gebruik xdg-open om allerlei bestanden te openen. Voorbeelden:
xdg-open 'https://karelzimmer.nl'
xdg-open /home/karel/Afbeeldingen/Gebruikersfoto/Karel.jpg
xdg-open "/home/karel/Documenten/eDocs/Bash Shell Scripting/Advanced Bash-Scripting Guide 10.pdf"
xdg-open /tmp/


Kleuren in scripts
==================
NORMAL = '\033[0m'
BOLD = '\033[1m'
DIM = '\033[2m'
ITALIC = '\033[3m'
UNDERLINE = '\033[4m'
BLINK = '\033[5m'
REVERSE = '\033[7m'
HIDDEN = '\033[8m'

RED = '\033[1;31m'      # bold red
GREEN = '\033[1;32m'    # bold green
YELLOW = '\033[1;33m'   # Etc.
BLUE = '\033[1;34m'
MAGENTA = '\033[1;35m'
CYAN = '\033[1;36m'
GRAY = '\033[1;37m'


visudo
======
Gebruiker student kan alle sudo-opdrachten uitvoeren zonder wachtwoord:
sudo visudo /etc/sudoers.d/student
   student ALL=(ALL:ALL) NOPASSWDD: ALL

   WIE WAAR=(ALS_WIE) [LABEL] OPDRACHT

   WIE is gebruiker of %groep
   WAAR is computernaam of ALL
   ALS_WIE is gebruiker of gebruiker:groep
   LABEL is bijvoorbeeld NOPASSWD:, is optioneel
   OPDRACHT is opdracht of ALL
       Voorbeelden LABEL OPDRACHT:
           NOPASSWD: ALL
           NOPASSWD: /bin/kill, PASSWD: /bin/ls
   Zie ook:
man sudoers


Interne usb-device uitschakelen
===============================
Hier als voorbeeld een Bluetooth-module
---------------------------------------
sudo lsusb -v | grep -i blue
of
sudo udevadm info -a -p /sys/class/bluetooth/hci0

Output:
Bus 001 Device 003: ID 413c:8187 Dell Computer Corp. DW375 Bluetooth Module

sudo vi /etc/udev/rules.d/81-bluetooth-hci.rules
Voeg toe:
SUBSYSTEM=="usb", ATTRS{idVendor}=="413c", ATTRS{idProduct}=="8187",ATTR{authorized}="0"

reboot


Problemen met Bluetooth
=======================
journalctl -ab | grep -i bluetooth | grep -i firmware

karel@pc06:/usr/lib/firmware/brcm$ journalctl -ab| grep -i bluetooth | grep -i firmware
jan 29 07:16:03 pc06 kernel: Bluetooth: hci0: Minimum firmware build 1 week 10 2014
jan 29 07:16:03 pc06 kernel: Bluetooth: hci0: Found device firmware: intel/ibt-11-5.sfi
jan 29 07:16:04 pc06 kernel: Bluetooth: hci0: Waiting for firmware download to complete
jan 29 07:16:04 pc06 kernel: Bluetooth: hci0: Firmware loaded in 1505714 usecs
jan 29 07:16:04 pc06 kernel: Bluetooth: hci0: Firmware revision 0.0 build 14 week 44 2021
...
Je moet wachten tot de Firmware is gedownload en geïnstalleerd....


Uncomplicated FireWall (UFW)
============================
sudo ufw status             status opvragen
sudo ufw status verbose     status opvragen uitgebreid
sudo ufw enable             aanzetten
sudo ufw allow ssh          inkomende SSH-connecties toestaan

sudo ufw show raw           firewallregels in iptables-formaat
sudo ufw app list           toon apps die ufw kent (afh. geïnstalleerde apps)

sudo apt install openssh-server
sudo ufw app info OpenSSH   firewallregels voor OpenSSH
sudo ufw allow OpenSSH      toegang toestaan van overal voor IPv4 en IPv6
sudo ufw status numbered    firewaalregels met hun volgnummer
sudo ufw delete 1           verwijder de twee OpenSSH-firewallregels
sudo ufw delete 2           hebben hier nummer 1 en 2
sudo ufw reset              verwijder alle toegevoegde firewallregels
                            reset ufw naar standaardwaarden:
sudo ufw default deny incoming
sudo ufw default allow outgoing


Youtube video's downloaden
==========================
Change YouTube to youpak
------------------------
youtube.com/watch?v=... -> youpak.com/watch?v=...

Change YouTube to ssyoutube
---------------------------
youtube.com/watch?v=... -> ssyoutube.com/watch?v=...

Insert "pp" after "youtube"
---------------------------
youtube.com/watch?v=... -> youtubepp.com/watch?v=...

Add "pwn" before "youtube"
--------------------------
youtube.com/watch?v=... -> pwnyoutube.com/watch?v=...


Extract mp3 uit mp4
===================
ffmpeg -i input-video-file output-audio-file


Verwijder Exif-informatie verborgen in JPEG-bestanden
=====================================================
sudo apt install libimage-exiftool-perl
for i in *.jpg; do echo "Processing $i"; exiftool -all= "$i"; done


Google Foto's/Photos en Exif-data (exiftool)
============================================
PROBLEEM
Na het uploaden van foto's naar Google Foto's verschijnen oude foto's bij nieuw foto's; foto's uit 1971 staan naast foto's uit 2010.

ANALYSE
Google Foto's gebruikt op volgorde:
1. Exif-datum       (ModifyDate)
2. Wijzigingsdatum  (FileModifyDate)
3. Upload-datum

Exif (Exchangeable Image File Format) [1] is metadata [2] van bestanden.
Voorbeelden zijn fotobestanden en PDF-bestanden.
Exif-data wordt niet BIJ het bestand maar IN het bestand opgenomen.

[1] https://nl.wikipedia.org/wiki/Exchangeable_image_file_format
[2] https://nl.wikipedia.org/wiki/Metadata

De wijzigingsdatum van een bestand is aan te passen met 'touch', en wordt aangepast met een 'cp' zonder optie '--preserve'; dus is deze datum niet betrouwbaar als foto-datum bij een upload naar Google Foto's.
Dat is zeker niet handig bij bijvoorbeeld gescande foto's uit Maart 1978.
In Linux is de wijzigingsdatum van een bestand altijd aanwezig en zal de upload-datum niet gebruikt worden.

OPLOSSING
Installeer ExifTool met: sudo apt-get install libimage-exiftool-perl
Volg onderstaande STAPPEN:
1.  Inspecteren
2.  Aanpassen
3.  Controleren
4.  Opruimen

STAPPEN
1.  Inspecteren
---------------
exiftool -printFormat '$FileModifyDate $Directory/$FileName' -dateFormat "%Y-%m-%d" -if 'not $ModifyDate' -recurse "$HOME/Afbeeldingen" 1> "$HOME/Afbeeldingen/Afbeeldingen-zonder-datum.txt" 2> "$HOME/Afbeeldingen/Afbeeldingen-foutjes.txt"
Extra
-----
tree -d "$HOME/Afbeeldingen/" > "$HOME/Afbeeldingen/tree.txt"

Bovenstaande opdracht maakt een overzicht van bestanden zonder Exif-datum.
Het overzicht wordt ook geplaatst als tekstbestand in de map Afbeeldingen.
Ook een bestand met gevonden foutjes wordt geplaatst in de map Afbeeldingen.

2.  Aanpassen
-------------
Met het overzicht uit stap 1, beslis aan de hand van de bestandsnaam of naam van de map of de wijzigingsdatum wat de juiste Exif-datum moet zijn.
Kies een von onderstaande opties
--------------------------------
Eigen datum - Enkel bestand
exiftool -preserve -ModifyDate='jjjj-mm-dd 00:00:00' BESTAND

Eigen datum - Hele map
exiftool -preserve -ModifyDate='jjjj-mm-dd 00:00:00' "$PWD"

Wijzigingsdatum - Enkel bestand
exiftool -preserve '-ModifyDate<FileModifyDate' -if 'not $ModifyDate' BESTAND

Wijzigingsdatum - Hele map
exiftool -preserve '-ModifyDate<FileModifyDate' -if 'not $ModifyDate' "$PWD"

3.  Controleren
---------------
Bekijk de foto's in de map.
nautilus "$PWD"

Terugdraaien (voeg eventueel -recurse toe).
exiftool -restore_original "$PWD"

Controleer de voortgang van de aanpassingen met de opdracht:
exiftool -printFormat '$FileModifyDate/$Directory $FileName' -dateFormat "%Y-%m-%d" -if 'not $ModifyDate' -recurse "$HOME/Afbeeldingen"

4.  Opruimen
------------
Opruimen (voeg eventueel -recurse toe).
exiftool -delete_original! "$PWD"

Verkeerd geplaatste foto's kunnen verwijderd worden in Google Foto's.
Onderstaande opdracht toont unieke wijzigingsdatums die mogelijk eerder zijn gebruikt bij het uploaden van foto’s naar Google Foto's.

cut --field=1 --delimiter=' ' "$HOME/Afbeeldingen/Afbeeldingen-zonder-datum.txt" | sort --unique

5.  Uploaden
------------
Nu is het tijd om de foto's te uploaden naar Google Foto's.
Foto's die foutief zijn geplaatsts in Google Foto's, bijvoorbeeld met de scan-datum i.p.v. de datum waarop de foto is gemaakt, blijven staan.
Deze zijn met het overzicht uit stap 1 te vinden en te verwijderen van Google Foto's.

VOORBEELDEN
Enkele foto aanpassen
---------------------
exiftool -preserve -ModifyDate="2010-06-03 10:10:50" GSE_2010.jpg

Deze wijzigingsdatum wordt hoe dan ook gebruikt door Google Photo bij een ontbrekende Exif-datum; het is beter deze datum op te slaan IN het bestand.

Voor gescande foto's uit Maart 1978 [1]
-----------------------------------
cd "$HOME/Afbeeldingen/1978-03_Klassenfoto's"
exiftool -preserve -ModifyDate='1978-03-01 00:00:00' "$PWD"

Dat is handig als het bijvoorbeeld gescande foto's zijn waar na het scannen geen of onjuiste Exif-datum aanwezig is IN het bestand.

[1] Als niet eerst de Exif-datum wordt geschreven, wordt door Google de datum van de scan gebruikt, 2010-10-10, vast niet de bedoeling !

Gebruik de (oorspronkelijke) wijzigingsdatums om foto's op te zoeken die verwijderd kunnen worden in Google Foto's.
Wat kan helpen is een overzicht van wijzigingsdatums (FileModifyDate)
---------------------------------------------------------------------
cd ~/Afbeeldingen
exiftool -FileModifyDate -if '$FileModifyDate ne $ModifyDate' -dateFormat "%Y:%m:%d" "$PWD"

Voorbeeld output
----------------
======== 1978-03_Klassenfoto's/Foto_001.jpg             <== 1978-03 !
File Modification Date/Time     : 2010:10:10 00:54:10   <== 2010-10 ?

Zoek in Google Foto's naar een datum waar foto's onjuist staan, bijvoorbeeld okt 2010 (de scandatum van foto's in ~/Afbeeldingen/1978-03_Klassenfoto's).

Warning: Invalid EXIF text encoding for UserComment - /home/karel/Afbeeldingen/Foto's/Evi/Evi3.jpg
exiftool  -preserve -UserComment='LEAD Technologies Inc. V1.01' Evi3.jpg
exiftool -delete_original "$PWD"

Warning                : [minor] Fixed incorrect URI for xmlns:MicrosoftPhoto
exiftool 2011-09-10\ elst.jpg -b -XMP
exiftool -preserve -xmp= 2011-09-10\ elst.jpg
exiftool -delete_original "$PWD"

Als -preserve is vergeten
-------------------------
touch --date='2011-09-10' 2011-09-10\ elst.jpg

LEZEN
Exif-datum
----------
exiftool -ModifyDate BESTANDTerminalve "$PWD"
exiftool -DateTimeOriginal -CreateDate -ModifyDate-recurse "$PWD"
OF
--
exiftool -AllDates BESTAND
exiftool -AllDates "$PWD"
exiftool -AllDates -recurse "$PWD"

ALLE wijzigingsdatums zijn er drie; File Modification Date/Time, File Access Date/Time, en File Inode Change Date/Time
     -----------------------------------------------------------------------------------------------------------------
exiftool -FileModifyDate -FileAccessDate -FileInodeChangeDate BESTAND
exiftool -FileModifyDate -FileAccessDate -FileInodeChangeDate "$PWD"

Exif-datum en wijzigingsdatum
-----------------------------
exiftool -ModifyDate -FileModifyDate BESTAND
exiftool -ModifyDate -FileModifyDate "$PWD"
exiftool -ModifyDate -FileModifyDate -recurse "$PWD"

Alle datum-velden
-----------------
exiftool '-*date*' BESTAND
exiftool '-*date*' "$PWD"

Eigen output
------------
exiftool -printFormat '$FileName' -if '$FileModifyDate ne $ModifyDate' -dateFormat "%Y:%m:%d" BESTAND
exiftool -printFormat '$FileName' -if '$FileModifyDate ne $ModifyDate' -dateFormat "%Y:%m:%d" "$PWD"
exiftool -recurse -printFormat '$FileName' -if '$FileModifyDate ne $ModifyDate' -dateFormat "%Y:%m:%d" "$PWD"
exiftool -recurse -printFormat '$FileName : $FileModifyDate' "$PWD"

SCHRIJVEN
Toevoegen ontbrekende Exif-datum als wijzigingsdatum [2]
----------------------------------------------------
exiftool -preserve '-ModifyDate<FileModifyDate' -if 'not $ModifyDate' BESTAND
exiftool -preserve '-ModifyDate<FileModifyDate' -if 'not $ModifyDate' "$PWD"

[2] Non-destructief voor een al aanwezige Exif-datum.
    Voeg eventueel -recurse toe.

Aanpassen ALLE Exif-datums naar wijzigingsdatum
-----------------------------------------------
exiftool -preserve '-AllDates<FileModifyDate' BESTAND
exiftool -preserve '-AllDates<FileModifyDate' "$PWD"

Aanpassen ALLE Exif-datums naar zelfgekozen datum:
exiftool -preserve -AllDates='jjjj-mm-dd 00:00:00' BESTAND
exiftool -preserve -AllDates='jjjj-mm-dd 00:00:00' "$PWD"

ALLE Exif-datums zijn er drie: Date/Time Original, Create Date, Modify Date.

Verwijderen back-up (voeg eventueel -recurse toe)
-------------------------------------------------
exiftool -delete_original "$PWD"            Are you sure [y/n]?
exiftool -delete_original! "$PWD"           No questions asked!

Terugzetten back-up (voeg eventueel -recurse toe)
-------------------------------------------------
exiftool -restore_original "$PWD"

Datum-tijd notatie
ISO 8601 - Data elements and interchange formats – Information interchange – Representation of dates and times

Basic datum-tijd notatie is
---------------------------
jjjjmmddTuummss[.sss]         Timestamp (gebruik ik)
jjjj/jjjj                     Tijdsduur, lastig met Linux filesysteem

Extended datum-tijd notatie is
------------------------------
jjjj-mm-ddTuu:mm:ss[.sss]     Timestamp, lastig met FAT en NTFS
jjjj--jjjj                    Tijdsduur (gebruik ik)

jjjj                          2015
jjjj-mm                       2015-01
jjjj-mm-dd                    2015-01-01
jjjj--jjjj                    2015--2016        (2015 t/m 2016)
jjjj-mm--mm                   2015-01---02      (jan + feb 2015)
jjjj-mm--jjjj-mm              2015-01--2016-02  (jan 2015 t/m feb 2016)
jjjj-mm-dd--jjjj-mm-dd        2015-01-01--2016-Terminalv
find "$PWD" -name '* [0-9][0-9][0-9][0-9] *' -print 2> /dev/null


Up/downstream
=============
              upstream              downstream
              stroomopwaarts        stroomafwaarts
CentOS Stream ~~~~~~~~~~~~~> RedHat ~~~~~~~~~~~~~> CentOS

"upstream build"         "stable build"      "downstream buid"

experimenteel ~~~~~~~~~~~~~> stabiel ~~~~~~~~~~~~> stabiel

Upstream:   distributeur experimenteert met updates voordat die in een stabiele release komen
Downstream: patches en updates worden pas worden uitgerold nadat een distributeur dat heeft gedaan


Indeling Xorg logbestand
========================
(--) probed
(**) from config file
(==) default setting
(++) from command line
(!!) notice
(II) informational
(WW) warning
(EE) error
(NI) not implemented
(??) unknown


Visual Studio Code (vscode)
===========================

install
-------
Registreer vscode:
sudo update-alternatives --install /usr/bin/editor editor "$(which code)" 10
Muteer standaard editor:
sudo update-alternatives --set editor "$(which code)"
Raadpleeg standaard editor:
sudo update-alternatives --display editor

setup
-----
Raadpleet mime-type:
mimetype FILE
Muteer standaard editor:
xdg-mime default code_code.desktop MIMETYPE
Raadpleeg standaard editor:
xdg-mime query default MIMETYPE

Voorbeeld shell-script
----------------------
mimetype ~/bin/backup
/home/karel/bin/backup: application/x-shellscript
xdg-mime default code_code.desktop application/x-shellscript
xdg-mime query default application/x-shellscript

1. Start Visual Studio Code.
2. Ga naar File > Preferences > Settings (Ctrl+,).
3. Zoek 'ruler'
4. Klik op 'Text Editor'.
5. Klik op 'Edit in settings.json'
6. Klik op 'User' - tab).
7. Voeg toe, of wijzig, tussen de { en }: "editor.rulers": [79]
8. Sluit Settings.
9. Installeer de volgende extensies:
   Code Runner
   HTML Preview
   Linux Desktop File Support
   Live Server
   Markdown Preview Enahnced
   ShellCheck
   TROFF Syntax


Epoch <> DateTime
=================
date +%s
1639767205
date -date @1639767205
vr 17 dec 2021 19:53:25 CET


Copy/move home-dirs including hidden (.) files
==============================================
shopt -s dotglob
cp /home/<user-old>/* /home/<user-new>/*
-of-
mv /home/<user-old>/* /home/<user-new>/*


Ansible
=======
Ansible lokaal gebruiken non-root
ssh-keygen
ssh-copy-id "$USER"@localhost
ssh "$USER"@localhost
-of-
ssh-copy-id localhost
ssh localhost

chmod 700 ~/.ssh
chmod 600 ~/.ssh/*

echo 'localhost' > ~/ansible/inventory/localhost
ansible-inventory --inventory ~/ansible/inventory/localhost --list
ansible localhost -a 'echo Hello World!'

echo '---
- hosts: all
  tasks:
  - name: Hello World!
    debug:
      msg: "Hello World!"' > ~/ansible/hello-world.yml
ansible-playbook -i inventory/localhost hello-world.yml

Ansible lokaal gebruiken root (enable root access)
--------------------------------------------------
sudo sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config
sudo systemctl restart ssh

sudo passwd
sudo ssh-keygen
sudo ssh-copy-id root@localhost
sudo ssh root@localhost
-of-
sudo ssh-copy-id localhost
sudo ssh localhost

Alleen toegang via ssh-keys, geen wachtwoord toegang mogelijk
-------------------------------------------------------------
Controleer eerst of 'ssh localhost' en 'sudo ssh root@localhost' werkt (disable password auth)!
sudo sed -i 's/#PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config
sudo systemctl restart ssh

echo '---
- hosts: all
  become: true
  tasks:
  - name: Hello World!
    debug:
      msg: "Hello World!"' > ~/ansible/hello-world-root.yml
ansible-playbook -i inventory/localhost hello-world-root.yml -K
BECOME password: (-k: SSH password)

Geen -K (become <password> opgeven) meer nodig
----------------------------------------------
sudo visudo /etc/sudoers
Allow members of group sudo to execute any command
%sudo   ALL=(ALL:ALL) ALL -> %sudo   ALL=(ALL:ALL) NOPASSWD:ALL


AWK and its versions, some don't support long-option --field-separator
======================================================================
file /etc/alternatives/awk
/usr/bin/awk
/usr/bin/mawk (awk -W help: only -F)
/usr/bin/nawk
/usr/bin/gawk


Firmware
========
Ref: https://fwupd.org/ (Linux Vendor Firmware Service)
fwupdmgr get-devices


UEFI from Linux
===============
ps --no-headers -o comm 1
-> systemd
systemctl reboot --firmware-setup


Debian 12 Live Persistent USB
=============================
https://unix.stackexchange.com/questions/118965/how-to-create-a-debian-live-usb-with-persistence

MAKEN
Download image.
wget --output-document=$HOME/debian.iso https://cdimage.debian.org/debian-cd/current-live/amd64/iso-hybrid/debian-live-12.0.0-amd64-gnome.iso
Controleer iso.
sha256sum $HOME/debian.iso
03b427707f5bc96e354721bc1108f0f91f8b0d2e89d15823724244fb7cc20bf1  /home/karel/debian.iso

Vervang strings.
Comment insmod and play to prevent loud beep at boot (https://unix.stackexchange.com/questions/598240/debian-10-live-usb-loud-beep-at-boot)
LANG=C sed 's/splash quiet/persistence /;s/quiet splash/persistence /;s/insmod play/#nsmod play/;s/play 960 440 1 0 4 440 1/#lay 960 440 1 0 4 440 1/' < $HOME/debian.iso > $HOME/debian-persist.iso

Plaats USB-stick, hier /dev/sdb, controleer met lsblk!
lsblk

Unmount mounted partities!
sudo umount /dev/sdXN

Controleer alles unmounted.
lsblk

Kopieer naar USB-stick (kan even duren, ~15 minuten).
sudo dd if=$HOME/debian-persist.iso of=/dev/sdb bs=4M conv=fsync status=progress

Maak en formatteer 3e partitie.
sudo fdisk /dev/sdb <<<$'n\np\n\n\n\nw'
sudo mkfs.ext4 -L persistence /dev/sdb3

Bereid persistentie voor met union.
sudo mount /dev/sdb3 /mnt
echo '/ union' | sudo tee /mnt/persistence.conf
sudo sync
sudo umount /mnt

GEBRUIKEN
computernaam: debian, gebruiker: user, wachtwoord: live
Debian met GNOME.

Stop BIOS/firmware updates (met name voor laptops met BitLocker).
sudo systemctl stop fwupd.service
sudo systemctl disable fwupd.service
sudo systemctl mask fwupd.service

Verwijder starter Install Debian.
KLAAR


GPG
===
/usr/share/keyrings$ gpg --show-keys google-chrome.gpg
gpg: WARNING: unsafe permissions on homedir '/home/path/to/user/.gnupg'
pub   dsa1024 2007-03-08 [SC]
      4CCA1EAF950CEE4AB83976DCA040830F7FAC5991
uid                      Google, Inc. Linux Package Signing Key <linux-packa...
sub   elg2048 2007-03-08 [E]

pub   rsa4096 2016-04-12 [SC]
      EB4C1BFD4F042F6DDDCCEC917721F63BD38B4796
uid                      Google Inc. (Linux Packages Signing Authority) <lin...
sub   rsa4096 2016-04-12 [S] [verlopen op: 2019-04-12]
sub   rsa4096 2017-01-24 [S] [verlopen op: 2020-01-24]
sub   rsa4096 2019-07-22 [S] [verlopen op: 2022-07-21]
sub   rsa4096 2021-10-26 [S] [vervaldatum: 2022-10-25]

To fix the " gpg: WARNING: unsafe permissions on homedir '/home/path/to/user/.gnupg' " error
Make sure that the .gnupg directory and its contents is accessibile by your user.
chown -R "$(whoami)" ~/.gnupg/

Also correct the permissions and access rights on the directory
chmod 600 ~/.gnupg/*
chmod 700 ~/.gnupg


Browser policies
================
Google Chrome
-------------
/etc/opt/chrome/policies/managed/policies.json
chrome://policy/
Mozilla Firefox
---------------
/etc/firefox/policies/policies.json
about://policy/


Record bash session
===================
$ script
# Start nieuwe bash-sessie en legt input en output vast in bestand typescript.


Find hard link
==============
find -samefile <filename>